<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Crossword</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Allerta">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/TableExport/3.3.13/js/tableexport.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>
<style type="text/css">
#crossword {
    text-align:center;
}

.crossword {
    border-collapse:collapse;
    font-family: 'Allerta', san-serif;
    font-style: normal;
    font-size: 35px;
    margin-left:auto;
    margin-right:auto;
    clear:both;
    margin-top:10px;
    margin-bottom:10px;
}

.crossword td {
    padding:0;
    margin:0;
    vertical-align:middle;
    padding:0;
    text-align:center;
    width:50px;
    height:50px;
}

.crossword .no-border {
    border:none;
}

#clues {
    margin:auto;
}

#clues td {
    vertical-align:top;
}
</style>
<script type="text/javascript" src="crossword.js"></script>

<script type="text/javascript">
window.onload = function(){
    var words = ["American", "Queer", "Liberal", "Democrat", "Woman"];

    // Create crossword object with the words
    var cw = new Crossword(words);

    // create the crossword grid (try to make it have a 1:1 width to height ratio in 10 tries)
    var tries = 10;
    var grid = cw.getSquareGrid(tries);

    // report a problem with the words in the crossword
    if(grid == null){
        var bad_words = cw.getBadWords();
        var str = [];
        for(var i = 0; i < bad_words.length; i++){
            str.push(bad_words[i].word);
        }
        alert("Shoot! A grid could not be created with these words:\n" + str.join("\n"));
        return;
    }

    // turn the crossword grid into HTML
    var show_answers = true;
    document.getElementById("crossword").innerHTML = CrosswordUtils.toHtml(grid, show_answers);

    $('#export_crossword').on('click', function() {
      	console.log('exporting');
      	//$('#preview-table').tableExport({type:'png',escape:'false'});

      	html2canvas($('#crossword'), {
      		onrendered: function(canvas) {
      			var img = canvas.toDataURL("image/png");
      			//var img = canvas.toDataURL("application/octet-stream");

      			function saveAs(uri, filename) {
      			    var link = document.createElement('a');
      			    if (typeof link.download === 'string') {
      			        document.body.appendChild(link); // Firefox requires the link to be in the body
      			        link.download = filename;
      			        link.href = uri;
      			        link.click();
      			        document.body.removeChild(link); // remove the link when done
      			    } else {
      			        location.replace(uri);
      			    }
      			}

      			var uri = img.replace(/^data:image\/[^;]/, 'data:application/octet-stream');
      			//window.open(url);
      			saveAs(uri, 'crossword.png');


      		}
      	});
      });
};
</script>

</head>

<body>
    <div id="crossword"></div>
    <table id="clues" style="visibility:hidden">
        <thead>
            <tr>
                <th>Across</th>
                <th>Down</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><ul id="across"></ul></td>
                <td><ul id="down"></ul></td>
            </tr>
        </tbody>
    </table>
    <button id="export_crossword">Export Crossword</button>

</body>
</html>
